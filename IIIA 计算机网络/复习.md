# 第一章 计算机网络概述
## 一、通信与计算机网络基础
### 1. 通信的定义与模型
- **定义**：信息从信源通过信道传送到信宿的过程，消息需按协议格式封装。
- **核心要素**：
  - 信源：信息发送者
  - 信道：信息传递路径
  - 信宿：信息接收者
  - 协议：通信双方遵守的规则
- **通信模式**：人-人、人-物、人-机、机-物、物-物、机-机通信

### 2. 计算机网络的定义与核心特征
- **定义**：由若干自治计算机系统通过通信链路和交换设备，按协议互连，实现资源共享与信息传递的系统。
- **核心特征（划重点）**：
  1. 自治：节点计算机具有独立操作系统和功能
  2. 互连：通过通信链路和交换设备连接
  3. 协议：共同遵守的规则（保障准确性和可靠性）
  4. 资源共享：共享软件、硬件、数据资源
  5. 信息传递：实现数据交换和通信

### 3. 网络的软硬件构成
- **硬件**：主机（端系统）、路由器、交换机、通信链路（光纤、同轴电缆、双绞线、无线电）
- **软件**：协议栈（一系列协议），核心协议包括HTTP、SMTP、DNS、TCP、IP等

### 4. 协议的核心概念
- **定义**：通信双方关于通信的约定，类比人类语言
- **三要素**：
  - 语法：数据与控制信息的结构/格式
  - 语义：控制信息含义、动作及应答
  - 同步：事件实现顺序
- **标准化**：形式为RFC（Request for comments），制定组织包括ITU、IEEE、ISO

## 二、计算机网络的演化历程
### 1. 早期电路交换网络
- **工作原理**：建立连接→交换数据→释放连接
- **特性**：
  - 需建立物理通路，独占信道
  - 实时通信，无延迟
  - 复用技术：频分复用（FDM）、时分复用（TDM）
- **问题**：灵活性差、信道利用率低、按占用时间收费

### 2. 分组交换网络（核心演化）
- **动机**：解决电路交换的局限性，满足计算机数据突发性传输需求
- **特性**：
  - 报文分割为分组传输
  - 采用存储转发技术
  - 分组可走不同路径
  - 节点间有冗余路由
- **工作流程**：报文切片→生成分组（添加首部）→发送分组→接收分组→报文还原
- **优势**：信道利用率高、支持更多用户、无需预先分配带宽
- **不足**：存在排队时延、分组携带控制信息（额外开销）、管理复杂

### 3. 两种交换技术对比
| 场景 | 推荐技术 | 原因 |
|------|----------|------|
| 连续传输大量数据 | 电路交换 | 传送时间远大于呼叫建立时间 |
| 突发数据传输 | 分组交换 | 提高信道利用率 |
| 用户数多、低活跃概率 | 分组交换 | 支持更多用户，性能相当 |

### 4. 衍生网络类型
- **虚电路网络**：模拟电路交换特征，需建立连接、路由固定、预留资源
- **数据报网络**：纯分组交换，无需建立连接，路由动态选择

### 5. 网络互联架构
- 核心：通过主干ISP、区域ISP、NAP（网络接入点）、IXP（互联网交换点）实现多网络互联
- CDN（内容分发网络）：解决网络瓶颈，通过边缘服务器缓存内容，缩短访问距离

## 三、计算机网络的分类
### 1. 按作用范围分类
| 类型 | 缩写 | 覆盖范围 | 典型应用 |
|------|------|----------|----------|
| 局域网 | LAN | 3-5公里（办公室、校园） | 公司内部网、校园网 |
| 城域网 | MAN | 几公里-几十公里（城市） | 城市公共服务设施互联 |
| 广域网 | WAN | 跨城市、国家、洲际 | 互联网、企业异地分支互联 |
| 个域网 | PAN | 几米内（个人周边） | 蓝牙耳机、智能手表连接 |

### 2. 按拓扑结构分类
- 总线网、星型网、树形网、环形网、网状网、混合型网

## 四、计算机网络的评价指标
### 1. 核心指标
- **带宽**：
  - 信号带宽：频率范围（Hz）
  - 信道带宽：允许通过的信号频率范围
  - 数据率（比特率）：数字信道传输速率（bps）
- **吞吐量**：实际传输比特速率（bps），受瓶颈链路限制
- **时延**：
  - 总时延=处理时延+排队时延+传输时延+传播时延
  - 往返时延（RTT）：发送到收到确认的总时间
- **信道/网络利用率**：信道/网络实际使用时间与总时间的比值
- **流量强度**：La/R（L=分组长度，a=平均到达速率，R=链路带宽），La/R<1时网络稳定

## 五、计算机网络的体系结构
### 1. 核心概念
- **实体**：可发送/接收信息的硬件/软件进程
- **对等体**：不同机器上的对应层实体
- **服务**：下层向上层提供的功能，通过服务原语实现
- **接口**：相邻层间的交互点（服务访问点SAP）
- **协议数据单元（PDU）**：对等层传输的数据单位
- **服务数据单元（SDU）**：层间交换的数据单位

### 2. 两种主流体系结构对比
| 特征 | ISO OSI/RM模型（7层） | TCP/IP参考模型（4层） |
|------|------------------------|------------------------|
| 分层 | 物理层→数据链路层→网络层→传输层→会话层→表示层→应用层 | 物理层+数据链路层→网络层→传输层→应用层 |
| 核心区别 | 明确区分服务、接口、协议；先有模型后有协议 | 未明确区分三者；先有协议后有模型 |
| 连接支持 | 网络层同时支持面向连接/无连接；传输层仅支持面向连接 | 网络层仅支持无连接；传输层同时支持两种模式 |
| 实用性 | 通用但与实际脱钩 | 不通用但与现实吻合 |

### 3. 因特网实际采用的5层模型
| 层级 | 功能 | 数据单位 | 核心协议 |
|------|------|----------|----------|
| 应用层 | 为应用进程提供通信服务 | 报文 | HTTP、FTP、SMTP、DNS |
| 传输层 | 端到端可靠传输，标识应用 | 报文段（TCP）/用户数据报（UDP） | TCP、UDP |
| 网络层 | 路由选择，跨网传输 | 分组 | IP |
| 数据链路层 | 链路传输，差错检测 | 帧 | PPP、以太网 |
| 物理层 | 比特流传输，定义物理接口 | 比特 | 无（定义物理特性） |

### 4. 数据流动过程
- 发送端：应用数据→各层添加首部（尾部）→比特流→物理介质
- 接收端：比特流→各层剥去首部（尾部）→还原应用数据

## 六、网络中的法律和社会问题
### 1. 网络中立性
- **核心原则**：ISP应平等对待所有流量，禁止屏蔽、限速、付费优先
- **争议点**：监管干预vs市场自由、ISP盈利需求vs公平竞争、服务质量vs用户选择权
- **意义**：维护互联网开放性，保障信息自由流动和创新

### 2. 网络安全威胁
- **定义**：可能导致数据、系统、服务受损的潜在/现实风险
- **核心要素**：威胁源（黑客、犯罪团伙等）、威胁路径（漏洞利用、钓鱼等）、威胁影响（数据泄露、系统崩溃等）
- **主要类型**：恶意软件（病毒、勒索软件）、网络攻击（DDoS、SQL注入）、数据安全威胁（泄露、篡改）、社会工程学攻击（钓鱼邮件、电话诈骗）
- **检测技术**：特征检测、异常检测、沙箱分析、威胁情报、AI驱动检测
- **防御策略**：基础防御（边界防护、数据加密、补丁管理）、针对性防御、应急响应与恢复

### 3. 网络隐私保护
- **核心原则**：最小必要、知情同意、目的限制
- **隐私vs安全**：隐私关注数据是否被过度收集/滥用，安全关注数据是否被非法获取/破坏
- **泄露场景**：过度收集权限、数据滥用、技术漏洞、黑产攻击
- **保护措施**：
  - 法律层面：《个人信息保护法》《GDPR》等
  - 技术层面：数据加密、隐私计算、匿名化
  - 管理层面：企业合规管理、员工培训
  - 个人层面：关闭非必要权限、强密码、警惕钓鱼

### 4. 其他问题
- **网络欺诈**：财产型（钓鱼、金融诈骗）、数据型（社工库攻击）、权限型（木马植入、账号盗用）
- **网络虚假信息**：特征为非真实性、传播性、目的性；识别方法包括来源核查、内容验证、逻辑分析

# 第二章 网络中的数据通信
## 一、网络中的信号及传输介质
### 1. 核心概念区分
- **信息**：有意义的内容（如“边关十万敌军入侵”“上课/下课”）
- **数据**：信息的数字化表示
- **信号**：数据在传输介质中的载体（电信号、光信号、无线电波等）

### 2. 网络中的信号类型
#### （1）按传输载体分类
| 信号类型 | 传输带宽 | 抗干扰能力 | 使用成本 | 主要应用场景 |
|----------|----------|------------|----------|--------------|
| 有线电信号 | 中等 | 中等 | 低 | 局域网、电话网 |
| 无线电信号 | 小~中等 | 弱 | 中 | WiFi、蜂窝网络 |
| 光信号 | 大 | 强 | 高 | 局域网、城域网、广域网 |

#### （2）按信号形式分类
- **模拟信号**：随时间连续变化，表达式为 `x(t)=Asin(2πft+φ)`（A=振幅，f=频率，φ=相位）
  - 复杂模拟信号可通过傅里叶变换分解
- **数字信号**：离散且值瞬时变化
  - 比特间隙：发送1比特的时间
  - 比特率：每秒发送的比特数（bps或b/s）

### 3. 传输介质分类及特性
#### （1）导引型介质（信号沿固体媒体传输）
| 介质类型 | 结构/原理 | 特点 | 分类 | 典型应用 |
|----------|-----------|------|------|----------|
| 双绞线 | 两根绝缘铜导线绞合，减小电磁干扰 | 成本低、安装方便、短距离适用 | 屏蔽双绞线（STP）、非屏蔽双绞线（UTP） | 以太网、电话线 |
| 同轴电缆 | 铜芯→绝缘层→金属编织层→外护套 | 抗干扰性好、带宽高于双绞线 | 基带同轴、宽带同轴 | 有线电视、老式以太网 |
| 光纤 | 利用光的全反射传输光脉冲，结构为芯线→包层→涂覆层→护套 | 带宽极高、抗干扰强、适合长距离 | 单模光纤（远距离）、多模光纤（短距离） | 骨干网、数据中心 |

#### （2）非导引型介质（信号自由传播）
- **无线电波**：发射器将信号调制为电磁波，通过空气传播
  - 频段分类：低频（AM广播）、高频（Wi-Fi、蓝牙）、超高频（4G/5G）
  - 影响因素：反射、障碍物阻隔、干扰

### 4. 以太网常用传输介质与标准
- 标准命名规则：
  - 前缀数字：传输速率（如10=10Mbps、100=100Mbps、1000=1Gbps、10G=10Gbps）
  - 后缀字母：传输介质（T=双绞线、F=光纤、2/5=同轴电缆）
- 典型标准示例：
  - 10BASE-T：双绞线，传输距离100m
  - 1000BASE-LX：单模/多模光纤，传输距离550m/5000m
  - 10GBASE-T：CAT6a双绞线，传输距离100m

## 二、网络中的数据传输
### 1. 通信模型与系统组成
- **核心要素**：信源→发送设备→传输系统→接收设备→信宿
- **典型示例**：PC机→调制解调器→公用电话网→调制解调器→PC机
  - 数字比特流→模拟信号（调制）→模拟信号→数字比特流（解调）

### 2. 信息编码方式（4类）
#### （1）数字-数字编码（数字信号表示数字信息）
| 编码类型 | 特点 | 典型方式 |
|----------|------|----------|
| 单极性编码 | 高电平=1，低电平=0，有直流分量 | - |
| 极化编码 | 正负电压表示，减轻直流问题 | 非归零编码（NRZ-L/NRZ-I）、归零编码（RZ）、双相位编码 |
| 双极性编码 | 正/负/零三电平，0=零电平，1=正负交替 | - |
- 关键编码：
  - 曼彻斯特编码（MPE）：比特中间跳变（负→正=1，正→负=0），自带同步
  - 差分曼彻斯特编码（DME）：比特中间跳变同步，起始跳变=0，无跳变=1

<img src="./asset/1.png" style="zoom:36%;" />

#### （2）数字-模拟编码（模拟信号表示数字信息）
- o核心原理：调制载波的振幅、频率、相位
| 编码类型 | 原理 | 特点 |
|----------|------|------|
| 幅移键控（ASK） | 不同振幅表示0/1 | 抗干扰差 |
| 频移键控（FSK） | 不同频率表示0/1 | 稳定性高于ASK |
| 相移键控（PSK） | 不同相位表示0/1，支持多状态（如4-PSK表示2比特） | 应用广泛 |
| 正交调幅（QAM） | 结合ASK和PSK，多振幅+多相位 | 高频谱效率 |

#### （3）模拟-数字编码（A/D转换）
- 步骤：采样→量化→编码
- 采样定理：采样频率＞信号最高频率的2倍，可无失真还原

#### （4）模拟-模拟编码
- 应用：传统有线电视、电话系统，适用于声音信号（20Hz~20kHz）

### 3. 基带信号与带通信号
- **基带信号**：信源直接产生的原始信号，含低频/直流分量，部分信道不支持
- **带通信号**：通过载波调制后的信号，适合长距离传输，需调制解调过程

### 4. 传输速率相关定理
#### （1）奈氏准则（无噪声信道）
- 核心公式：波特率 `B = 2×W`（W=信道带宽，单位Hz）
- 比特率与波特率关系：`S = B×log₂N`（N=码元状态数）
- 意义：无噪声时，信道最大传输速率由带宽和码元状态决定

#### （2）香农定理（有噪声信道）
- 核心公式：`C = W×log₂(1＋S/N)`（C=最大传输速率，S/N=信噪比）
- 信噪比换算：`信噪比(dB) = 10×log₁₀(S/N)`
- 意义：噪声存在时，传输速率受带宽和信噪比双重限制

### 5. 信道通信方式
#### （1）按传输方向分类
- 单工：单向传输（如广播电视）
- 半双工：双向但不同时（如对讲机）
- 全双工：双向同时传输（如电话）

#### （2）按接收方分类
- 点到点通信：一对一（如拨号上网）
- 广播通信：一对多（如无线广播）

### 6. 物理层功能与设备
#### （1）物理层核心功能
- 解决比特传输问题，定义接口四特性：
  - 机械特性：插头、线缆、针脚排列
  - 电气特性：电压、电流规格
  - 功能特性：线路电压含义
  - 规程特性：发送/接收时序

#### （2）常见物理层设备
- **中继器**：再生放大信号，延长传输距离，两端为同一协议/速率的网段
- **集线器**：共享式设备，放大转发信号到所有端口（除输入端口），无定向传输能力

## 三、数据可靠传输的基本需求
### 1. 数据传输的异常情况
| 异常类型 | 原因 | 影响 |
|----------|------|------|
| 数据丢失 | 信道质量差、网络拥塞、路由环路 | 部分数据未到达接收方 |
| 数据出错 | 电磁干扰、信号衰减、编码错误 | 数据比特位改变，无法解析 |
| 数据乱序 | 多路径传输、负载均衡、重传错乱 | 接收顺序与发送顺序不一致 |
| 数据重复 | ACK丢失、缓存错误 | 接收方重复处理数据 |

### 2. 异常检测方法
- **丢包检测**：Ping命令（ICMP Echo请求）、Traceroute路由跟踪
- **丢包率计算**：`丢包率 = (丢失数据包数/发送数据包总数)×100%`
- **差错检测**：误码率（`出错比特数/总比特数`）、校验和、奇偶校验、循环冗余校验（CRC）

### 3. 可靠传输的基本需求
| 需求类型 | 具体要求 | 说明 |
|----------|----------|------|
| 功能性 | 无丢失 | 所有发送数据均需到达接收方 |
| 功能性 | 无错误 | 到达数据与原始数据一致 |
| 功能性 | 按序到达 | 乱序数据需重排后交付 |
| 功能性 | 无重复 | 避免数据重复处理 |
| 性能性 | 高效 | 高传输效率，低资源占用 |

### 4. 核心差错检测技术
| 检测方式 | 应用层 | 原理 |
|----------|--------|------|
| 校验和 | 运输层、网络层 | 报文16比特字求和，进位回卷，接收方比对 |
| 奇偶校验 | 链路层 | 增加1比特，使总比特数为奇/偶数 |
| 循环冗余校验（CRC） | 链路层 | 基于多项式运算，检错能力强 |

## 四、数据可靠传输模型及传输协议设计
### 1. 可靠传输任务建模
- 核心目标：N层利用N-1层的不可靠传输服务，为N+1层提供可靠传输服务
- 关键函数：
  - `rdt_send()`：上层调用，发送数据
  - `udt_send()`：调用底层，传输分组（不可靠）
  - `rdt_rcv()`：接收底层分组
  - `deliver_data()`：交付数据给上层

<img src="./asset/2.png" style="zoom:80%;" />

### 2. 逐步演进的可靠传输协议（FSM描述）
#### （1）Rdt 1.0（可靠信道）
- 假设：无比特错误、无丢包
- 逻辑：发送方直接发送分组，接收方直接交付数据，无反馈机制

#### （2）Rdt 2.0（存在比特错误）
- 核心机制：差错检测（校验和）+ 反馈（ACK/NAK）+ 检错重传
- 局限：ACK/NAK分组可能受损，无法分辨

<img src="./asset/3.png" style="zoom: 55%;" />

  

#### （3）Rdt 2.1（解决ACK/NAK受损）
- 改进：分组编号（0/1交替），接收方通过序号确认分组，发送方根据序号重传

- 发送方：支持序号0/1的分组发送与确认等待

- 接收方：

  - 若序号是**期望的** → 接收并发送 ACK。

  - 若是**重复分组**（序号与上次相同）→ 仍发送 ACK（避免发送方因 ACK 丢失而重传）

#### （4）Rdt 2.2（取消NAK）
- 优化：仅用ACK反馈，ACK包含确认序号，重复ACK视为NAK
- 接收方：对最后正确接收的分组发送ACK，无需NAK

#### （5）Rdt 3.0（存在丢包）
- 新增机制：超时重传

- 发送方：发送分组后启动定时器，超时未收到ACK则重传

- 接收方：保持按序接收与ACK反馈逻辑

<img src="./asset/4.png" style="zoom: 55%;" />

### 3. 缓冲区设计规则
- 发送端缓冲区：不小于链路带宽-时延积（确保RTT内链路不空闲）
- 接收端缓冲区：至少等于带宽-时延积（避免因缓冲区不足导致发送端停发）

## 五、数据可靠传输模型的性能优化
### 1. Rdt 3.0的性能瓶颈
- 问题：停-等机制导致链路利用率极低（如1Gbps链路、15ms RTT，吞吐量仅33kB/sec）
- 根源：发送方需等待前一分组ACK才能发送下一分组，链路空闲时间长

### 2. 核心优化技术：流水线技术
- 原理：允许发送方连续发送多个分组，无需等待即时ACK
- 关键要求：
  - 扩大分组序号范围（k位编码）
  - 增大发送方/接收方缓冲区（窗口机制）

### 3. 两种流水线协议对比
#### （1）回退N步（GBN）协议
| 特性 | 具体说明 |
|------|----------|
| 确认方式 | 累积ACK（ACK(n)确认序号≤n的所有分组） |
| 定时器 | 对所有未确认分组统一设置一个定时器 |
| 超时处理 | 重传超时分组及窗口内所有后续分组 |
| 失序分组 | 丢弃不缓存，重发最高序号正确分组的ACK |
| 窗口大小 | 发送方窗口≤2ᵏ-1，接收方窗口=1 |

#### （2）选择重传（SR）协议
| 特性 | 具体说明 |
|------|----------|
| 确认方式 | 单个ACK（ACK(n)仅确认分组n） |
| 定时器 | 为每个未确认分组单独设置定时器 |
| 超时处理 | 仅重传超时的单个分组 |
| 失序分组 | 缓存窗口内的失序分组，按序交付 |
| 窗口大小 | 发送方/接收方窗口≤2ᵏ⁻¹ |

### 4. ARQ协议家族总结
- 定义：自动重传请求（Automatic Repeat reQuest），利用确认和超时保证可靠性
- 包含协议及窗口特性：
  | 协议类型 | 最大发送窗口 | 接收窗口 |
  |----------|--------------|----------|
  | 停-等协议（Rdt 3.0） | 1 | 1 |
  | GBN协议 | N<序号空间大小 | 1 |
  | SR协议 | N<1/2×序号空间大小 | N |

### 5. 滑动窗口性能优化
- 窗口大小影响：窗口越大，吞吐率越高（受限于带宽×时延）
- 最佳窗口值：基于带宽-时延积估算，确保链路充分利用
- 流量控制核心：接收方通过窗口大小控制发送方发送速率，避免缓冲区溢出

# 第三章 网络服务及应用
## 一、网络服务概述
### 1. 网络应用体系架构
| 架构类型 | 核心特征 | 典型应用 | 优缺点 |
|----------|----------|----------|--------|
| 客户机/服务器（C/S） | 存在中心服务器，客户机主动连接 | Web、FTP、电子邮件 | 优点：易管理、服务稳定；缺点：服务器压力大、扩展性差 |
| P2P体系架构 | 节点既为客户机也为服务器，直接通信 | 迅雷、PPLive、BT | 优点：高可扩展性、资源分布式存储；缺点：难管理、安全性较差 |
| 混合体系架构 | 结合C/S和P2P特性 | 微信、QQ（文件传输+服务器认证） | 优点：兼顾稳定性和扩展性；缺点：架构复杂 |

### 2. 网络应用的传输服务需求
| 应用类型 | 数据丢失容忍度 | 带宽需求 | 实时性要求 | 典型传输协议 |
|----------|----------------|----------|------------|--------------|
| 文件传输、电子邮件 | 零容忍 | 弹性 | 无 | TCP |
| Web网页 | 零容忍 | 弹性 | 无 | TCP |
| 实时音频/视频 | 允许丢失 | 音频5Kb-1Mb、视频10Kb-5Mb | 100ms内 | UDP（部分用TCP） |
| 交互式游戏 | 允许丢失 | 几Kb/s以上 | 100ms内 | UDP |
| 金融应用 | 零容忍 | 弹性 | 有条件 | TCP |

### 3. 因特网提供的两类核心传输服务
#### （1）TCP服务
- 核心特性：面向连接、可靠传输、流量控制、拥塞控制
- 不提供：实时性、最小带宽承诺
- 适用场景：对可靠性要求高的应用（文件传输、网页浏览、邮件）

#### （2）UDP服务
- 核心特性：无连接、不可靠传输
- 不提供：连接建立、可靠性、流量控制、拥塞控制
- 适用场景：实时性要求高、可容忍少量丢包的应用（IP电话、流媒体、游戏）

### 4. 多路复用与多路分解
- **核心概念**：
  - 复用：发送方不同应用进程的数据通过同一传输层协议（TCP/UDP）封装后，共用网络层通道传输
  - 分用：接收方传输层根据端口号，将数据交付给对应的应用进程
- **关键标识**：
  - 端口号（16位）：标识主机内的应用进程，范围0-65535（0-1023为知名端口）
  - 套接字（Socket）：IP地址+端口号，唯一标识互联网中的通信端点
  - TCP套接字：四元组（源IP、源端口、目的IP、目的端口）

## 二、面向无连接的不可靠服务—UDP协议
### 1. UDP协议核心特性
- 仅提供两大功能：多路复用/多路分解、差错检查
- 无连接、无可靠性保证、无流量控制、无拥塞控制
- 首部开销小（8字节），相比TCP（20字节固定首部）更高效

### 2. UDP数据报结构（32位对齐）
| 字段 | 长度（比特） | 功能 |
|------|--------------|------|
| 源端口号 | 16 | 标识发送方应用进程 |
| 目的端口号 | 16 | 标识接收方应用进程 |
| 长度 | 16 | 包含首部的UDP数据报总字节数 |
| 检查和 | 16 | 校验数据报完整性（可选，IPV6强制） |
| 应用数据 | 可变 | 上层应用数据 |

### 3. UDP的优势与适用场景
- 优势：无需建立连接（低时延）、协议简单、无拥塞控制（可按需发送）
- 典型应用：域名解析（DNS）、IP电话、流媒体、网络管理（SNMP）、HTTP/3

### 4. UDP的潜在问题与解决
- 问题：大量UDP流量可能导致网络拥塞，挤占TCP带宽
- 可靠UDP实现：在应用层自行添加重传、序号、确认机制（如RTP协议）

## 三、面向连接的可靠服务—TCP协议
### 1. TCP协议核心目标
- 面向连接、全双工、点对点、可靠有序字节流
- 支持流量控制、拥塞控制、流水线传输

### 2. TCP报文段首部结构（20字节固定部分）          

<img src="./asset/5.png" style="zoom: 55%;" />             



| 字段 | 长度（比特） | 功能 |
|------|--------------|------|
| 源端口号/目的端口号 | 16/16 | 应用进程标识 |
| 序列号（Seq） | 32 | 报文段数据中第一个字节的字节流编号 |
| 确认号（Ack） | 32 | 期待接收的下一个字节的序列号（累积确认） |
| 首部长度 | 4 | 标识TCP首部总长度（以4字节为单位） |
| 标志位 | 6 | SYN（连接建立）、ACK（确认）、FIN（连接释放）、RST（重置）等 |
| 窗口 | 16 | 流量控制窗口大小（接收方剩余缓存空间） |
| 检查和 | 16 | 校验报文段完整性 |
| 紧急指针 | 16 | 指向紧急数据的偏移量 |
| 选项（可选） | 可变 | 如最大报文段长度（MSS）、窗口扩大因子等 |

### 3. TCP核心机制
#### （1）序号与确认机制
- 序列号：按字节流编号，确保数据有序
- 确认号：对已接收数据的确认，采用累积确认（确认号=N表示前N-1字节已接收）
- 乱序处理：TCP规范未明确，由实现者决定（通常缓存乱序报文段）

#### （2）流量控制（基于滑动窗口）
- 核心目标：防止发送方发送过快导致接收方缓存溢出
- 实现方式：接收方通过TCP首部的“窗口”字段，告知发送方可发送的最大字节数（RcvWindow）
- 特殊情况：RcvWindow=0时，发送方发送1字节探测报文，确认接收方缓存状态

#### （3）连接管理（三次握手+四次挥手）
- 连接建立（三次握手）：
  1. 客户端发送SYN报文（Seq=x）
  
  2. 服务器回复SYN+ACK报文（Seq=y，Ack=x+1）
  
  3. 客户端发送ACK报文（Seq=x+1，Ack=y+1）
  

<img src="./asset/6.png" style="zoom: 55%;" />

- 连接释放（四次挥手）：
  1. 主动方发送FIN报文（Seq=x）
  2. 被动方回复ACK报文（Ack=x+1）—— 半关闭状态
  3. 被动方发送FIN报文（Seq=y）
  4. 主动方回复ACK报文（Ack=y+1）

<img src="./asset/7.png" style="zoom: 41%;" />

#### （4）重传机制
- 超时重传：基于RTT估算超时时间，超时未确认则重传
- 快速重传：收到3个重复ACK，立即重传丢失报文段（无需等待超时）
- 超时间隔加倍：每次重传后，超时时间设为先前的2倍（退避机制）

#### （5）RTT估算与超时设置

当获得一个新的 RTT_sample 后，按以下公式更新 SRTT 和 RTTVAR：

> **注**：α = 1/8，β = 1/4（即权重，RFC 建议值）

- **第一次测量时**：
  \[
  \text{SRTT} = \text{RTT\_sample}
  \]
  \[
  \text{RTTVAR} = \frac{\text{RTT\_sample}}{2}
  \]

- **后续测量时**：
  \[
  \text{RTTVAR} = (1 - \beta) \times \text{RTTVAR} + \beta \times |\text{SRTT} - \text{RTT\_sample}|
  \]
  \[
  \text{SRTT} = (1 - \alpha) \times \text{SRTT} + \alpha \times \text{RTT\_sample}
  \]

即：
\[
\text{RTTVAR} = \frac{3}{4} \times \text{RTTVAR} + \frac{1}{4} \times |\text{SRTT} - \text{RTT\_sample}|
\]
\[
\text{SRTT} = \frac{7}{8} \times \text{SRTT} + \frac{1}{8} \times \text{RTT\_sample}
\]

 **RTO（重传超时时间）计算**
\[
\text{RTO} = \text{SRTT} + 4 \times \text{RTTVAR}
\]


## 四、万维网（World Wide Web）
### 1. WEB核心构成
- 三大组件：Web服务器（IIS、Apache、TomCat）、浏览器（Chrome、Firefox）、HTTP协议
- 核心模式：C/S模式，基于TCP协议（默认端口80）
- 内容标识：URL（统一资源定位符），格式为`协议://主机名/路径名`（如`http://www.hust.edu.cn/cs/pic.gif`）

### 2. HTTP协议核心特性
- 无状态协议：服务器不维护客户端会话状态（通过Cookie补充）
- 报文类型：请求报文（客户端→服务器）、响应报文（服务器→客户端）

### 3. HTTP请求报文结构
- 组成：请求行 + 首部行 + 空行 + 实体主体
- 请求行格式：`方法 URL 版本`（如`GET /index.html HTTP/1.1`）
- 核心方法：
  - GET：请求指定URL的资源（数据可放在URL中）
  - POST：提交表单数据（数据放在实体主体中）
  - HEAD：仅返回响应报文首部，不包含资源
  - PUT/DELETE：上传/删除指定资源

### 4. HTTP响应报文结构
- 组成：状态行 + 首部行 + 空行 + 实体主体
- 状态行格式：`版本 状态码 短语`（如`HTTP/1.1 200 OK`）
- 常见状态码：
  - 200 OK：请求成功
  - 301 Moved Permanently：资源永久迁移
  - 404 Not Found：资源未找到
  - 505 HTTP Version Not Supported：协议版本不支持

### 5. HTTP传输模式演进
| 版本 | 传输模式 | 特点 | 优缺点 |
|------|----------|------|--------|
| HTTP/1.0 | 非持久性连接 | 每个对象建立一个TCP连接 | 优点：实现简单；缺点：连接开销大、时延高 |
| HTTP/1.1 | 持久连接 | 单个TCP连接传输多个对象（流水线/非流水线） | 优点：减少连接开销；缺点：存在队首阻塞（HOL） |
| HTTP/2 | 报文分帧 | 按优先级分帧传输，支持服务器推 | 优点：解决HOL阻塞；缺点：依赖TCP（仍有连接级阻塞） |
| HTTP/3 | QUIC协议 | 基于UDP，零RTT连接建立 | 优点：彻底解决阻塞，低时延；缺点：兼容性需适配 |

### 6. Cookie技术（会话状态管理）
- 核心组成：HTTP响应首部（Set-Cookie）、HTTP请求首部（Cookie）、客户端Cookie文件、服务器后端数据库
- 功能：实现用户认证、购物车、个性化推荐等会话相关功能
- 隐私问题：可能泄露用户行为数据，需注意权限控制

## 五、文件传输协议（FTP）
### 1. FTP核心特性
- 基于C/S模式，使用TCP协议，端口21（控制连接）、20（数据连接）
- 双连接机制：
  - 控制连接：持久连接，传输命令（USER、PASS、LIST、RETR、STOR）和响应
  - 数据连接：临时连接，传输文件数据或目录列表
- 带外控制：控制信息与数据分开传输（区别于HTTP的带内控制）

### 2. FTP与HTTP的区别
| 对比维度 | FTP | HTTP |
|----------|-----|------|
| 连接类型 | 双连接（控制+数据） | 单连接 |
| 控制方式 | 带外控制 | 带内控制 |
| 状态维护 | 有状态（维护用户会话） | 无状态 |
| 主要用途 | 大批量文件传输 | 网页资源传输 |

### 3. 常见的FTP应答

- 331 Username OK, password required
- 125 data connection already open; transfer starting
- 425 Can’t open data connection
- 452 Error writing file

## 六、电子邮件服务
### 1. 电子邮件系统构成
- 三大组件：用户代理（Outlook、FoxMail）、邮件服务器、SMTP协议
- 核心协议：
  - SMTP：简单邮件传输协议，用于邮件服务器之间发送邮件（TCP端口25）
  - POP3/IMAP：用于客户端从邮件服务器接收邮件（POP3端口110，IMAP端口143）

### 2. SMTP协议核心特性
- 基于TCP可靠传输，采用“推”模式（服务器→服务器）
- 传输阶段：握手→报文传输→结束
- 报文格式：首部（To、From、Subject）+ 空行 + 信体（要求7-bit ASCII码，非ASCII需MIME扩展）

### 3. 邮件接收协议对比
| 协议 | 核心特性 | 适用场景 |
|------|----------|----------|
| POP3 | 下载-删除/保存模式，无状态，不支持服务器端邮件组织 | 单设备接收邮件，对同步要求低 |
| IMAP | 邮件存储在服务器，支持文件夹管理、状态同步，有状态 | 多设备同步邮件，需服务器端组织邮件 |

### 4. MIME扩展（多用途互联网邮件扩展）
- 解决问题：SMTP仅支持7-bit ASCII码的限制
- 核心字段：MIME-Version（版本）、Content-Type（媒体类型）、Content-Transfer-Encoding（编码方式，如base64）

## 七、域名解析服务（DNS）
### 1. DNS核心功能
- 域名→IP地址映射（核心功能）
- 辅助功能：主机/邮件服务器别名解析、负载均衡（一个域名对应多个IP）

### 2. DNS体系结构
- 分布式数据库，层次化组织：
  - 根DNS服务器（13个）：顶级域名解析入口
  - 顶级域（TLD）服务器：负责.com、.edu、.cn等顶级域名解析
  - 权威DNS服务器：特定组织的域名服务器，提供权威解析
  - 本地DNS服务器：代理客户端查询，缓存解析结果（非层次结构成员）

### 3. 域名结构
- 层次树状结构：`四级域名.三级域名.二级域名.顶级域名`（如`mail.cs.hust.edu.cn`）
- 顶级域名分类：通用顶级域（.com、.org、.edu）、国家/地区顶级域（.cn、.us、.uk）

### 4. DNS解析过程
- 两种查询方式：
  - 递归查询：本地DNS服务器向层次结构逐层查询，最终返回结果给客户端
  - 迭代查询：本地DNS服务器向根服务器查询，根服务器返回下一级服务器地址，客户端逐级查询
- 缓存机制：域名服务器缓存解析结果，过期自动失效（减少查询时延和根服务器负载）

### 5. DNS记录格式（RR）
- 格式：`(name, value, type, ttl)`
- 核心类型：
  - A记录：name=主机名，value=IP地址（域名→IP）
  - NS记录：name=域名，value=该域的权威DNS服务器主机名
  - CNAME记录：name=别名，value=真实主机名（别名解析）
  - MX记录：name=域名，value=邮件服务器主机名（邮件路由）

## 八、P2P文件分发
### 1. P2P核心特性
- 无中心服务器，节点兼具客户端和服务器功能
- 高可扩展性：节点越多，总带宽越大，分发效率越高
- 分发模式：文件分块传输，节点间相互上传/下载分块

### 2. C/S与P2P文件分发对比
| 对比维度 | C/S模式 | P2P模式 |
|----------|---------|---------|
| 服务器压力 | 集中负载，压力大 | 分布式负载，无中心压力 |
| 扩展性 | 差（服务器瓶颈） | 好（节点越多效率越高） |
| 分发时延 | 随用户数增加而增长 | 用户数增加时延增长缓慢 |
| 可靠性 | 依赖中心服务器，单点故障风险 | 分布式架构，可靠性高 |

# 第四章 局域网
## 一、局域网概述
### 1. 局域网定位与核心特征
- 核心定义：为地理位置临近的设备提供高速互联，是计算机网络的基本构建单元
- 链路与数据链路区分：
  - 链路：两相邻节点间的物理通道（有线/无线）
  - 数据链路：链路基础上结合硬件和协议的功能层（对应OSI第二层），含帧封装、差错检测、流量控制、MAC等功能

### 2. 局域网拓扑结构
| 拓扑类型 | 核心特征 | 典型应用 |
|----------|----------|----------|
| 总线型 | 所有设备共享一条总线，易布线 | 早期10BASE5、10BASE2同轴电缆以太网 |
| 星型 | 设备通过单独链路连接中央设备（集线器/交换机） | 现代以太网主流，双绞线组网（10BASE-T等） |
| 树型 | 层次化星型结构，骨干链路级联 | 大型企业网、校园网，结合VLAN和三层交换 |
| 环形 | 节点首尾相连，单点断开可能影响整体 | 工业以太网（ERPS协议）、令牌环变种 |

### 3. 链路类型对比
| 链路类型 | 基本特征 | 典型例子 |
|----------|----------|----------|
| 广播链路 | 多设备共享信道，消息被所有设备接收 | 总线型以太网、无线局域网 |
| 点到点链路 | 两台设备专用链路，数据仅双向传输 | 交换机与主机间的链路 |

### 4. 有线与无线局域网对比
| 对比维度 | 有线局域网 | 无线局域网 |
|----------|------------|------------|
| 传输介质 | 双绞线、同轴电缆、光纤 | 无线电波 |
| 速率 | 常见100Mbps、1Gbps、10Gbps，稳定 | Wi-Fi 7可达10G+bps，受距离/干扰影响大 |
| 抗干扰性 | 强，不易受无线电干扰 | 弱，易受电磁波、障碍物影响 |
| 稳定性 | 延迟低、带宽稳定 | 延迟和带宽波动大 |
| 部署灵活性 | 布线复杂，灵活性差 | 无需布线，易于扩展和移动 |

## 二、多路访问链路和协议
### 1. 核心问题与协议目标
- 核心问题：广播链路中多设备同时发送数据会导致信号碰撞，接收端无法识别
- 协议目标：全分散控制、单节点独占信道时吞吐量为R、多节点共享时各节点吞吐量为R/M、简单易实现

### 2. 多路访问协议分类及特性
#### （1）信道划分协议
- 核心思想：将信道划分为多个“片”（时隙、频率、编码），分配给节点专用
| 协议类型 | 工作方式 | 优势 | 不足 |
|----------|----------|------|------|
| TDMA（时分多址） | 循环分配固定长度时隙，仅在时隙内发送 | 无碰撞 | 无数据时时隙空闲，信道浪费 |
| FDMA（频分多址） | 划分固定频段分配给节点 | 无碰撞 | 频段闲置时信道浪费 |
| CDMA（码分多址） | 所有节点共享全频段，通过独特编码区分 | 无碰撞、频谱利用率高 | 需信号同步，实现复杂 |

#### （2）随机访问协议
- 核心思想：信道不分割，允许碰撞，含碰撞检测与恢复机制
| 协议类型 | 工作方式 | 效率 | 典型应用 |
|----------|----------|------|----------|
| 纯ALOHA | 有数据即发送，碰撞后随机重传 | 18%（1/(2e)） | 早期无线通信 |
| 时隙ALOHA | 时间划分时隙，仅在时隙开始时发送 | 37%（1/e） | 卫星通信 |
| CSMA（载波监听） | 发送前监听信道，空闲则发送，忙则等待 | 高于ALOHA | - |
| CSMA/CD（带碰撞检测） | 发送中检测碰撞，碰撞后立即停止并发送干扰信号 | 性能优于CSMA | 有线以太网 |
| CSMA/CA（带碰撞避免） | 发送前监听，通过预约机制避免碰撞 | 适配无线环境 | 无线局域网（802.11） |

#### （3）轮流协议
- 核心思想：节点轮流使用信道，平衡轻/重负荷场景
| 协议类型 | 工作方式 | 优势 | 不足 |
|----------|----------|------|------|
| 轮询协议 | 主节点邀请从节点轮流传输 | 无碰撞 | 主节点单点失效，轮询开销 |
| 令牌传递协议 | 令牌依次通过节点，持有令牌方可发送 | 公平性好 | 令牌丢失影响整体，有令牌开销 |

### 3. 关键协议细节
#### （1）CSMA分类
- 非坚持CSMA：信道忙则延迟随机时间后重监听
- 1坚持CSMA：信道忙则持续监听，空闲立即发送，易碰撞
- P坚持CSMA：信道空闲时以概率P发送，1-P延迟后重监听，平衡冲突与利用率

#### （2）CSMA/CD核心机制
- 碰撞检测：发送时监测信号强度，对比收发信号（有线易实现，无线困难）
- 强化碰撞：碰撞后发送干扰信号，通知所有节点
- 争用期（碰撞窗口）：2倍端到端往返时延（2τ），超过则确认无碰撞
- 最短有效帧长：64字节（10Mb/s以太网），小于则为无效冲突帧

#### （3）CSMA/CA核心机制
- 碰撞避免：通过RTS（请求发送）/CTS（允许发送）预约信道
- 链路层确认：接收方收到正确帧后，等待SIFS后返回ACK，解决隐藏终端问题

## 三、以太网
### 1. 以太网发展与标准
- 起源：1970年代Xerox PARC发明，基于CSMA/CD，早期为总线型，后过渡到星型
- 主流标准：
  - 10BASE-T：双绞线，10Mbps，传输距离100m
  - 100BASE-TX：快速以太网，100Mbps，双绞线
  - 1000BASE-T：千兆以太网，1Gbps，双绞线
  - 10GBASE-T：万兆以太网，10Gbps，CAT6a双绞线

### 2. 以太网帧结构
| 字段 | 长度 | 功能 |
|------|------|------|
| 前同步码 | 7字节 | 10101010重复，同步发送方与接收方时钟 |
| 帧开始定界符（SFD） | 1字节 | 10101011，标志帧的真正开始 |
| 目的地址 | 6字节 | 接收方MAC地址（广播地址为FF-FF-FF-FF-FF-FF） |
| 源地址 | 6字节 | 发送方MAC地址（烧录在网卡ROM中，不可更改） |
| 类型 | 2字节 | 上层协议类型（如IP协议） |
| 数据 | 46-1500字节 | 上层数据，不足46字节则填充 |
| CRC | 4字节 | 循环冗余校验，检测帧传输错误 |

### 3. MAC地址
- 组成：48比特，前24比特为OUI号（IEEE分配），后24比特由厂商自行分配
- 作用：数据链路层标识网络适配器，实现广播信道寻址

### 4. 以太网核心设备对比
| 设备类型 | 工作层次 | 核心功能 | 碰撞域影响 |
|----------|----------|----------|------------|
| 集线器（Hub） | 物理层 | 信号整形放大，转发到所有端口 | 所有端口在同一碰撞域 |
| 交换机（Switch） | 数据链路层 | 存储转发，基于MAC地址过滤转发 | 每个端口为独立碰撞域 |
| 路由器（Router） | 网络层 | 基于IP地址路由转发，隔离广播域 | 每个接口连接独立广播域 |

### 5. 交换机工作原理
- 站表维护：记录MAC地址与接口的映射关系，动态学习（源MAC地址学习）
- 转发逻辑：收到帧后缓存，查找站表，向目标接口转发，同一网段内帧不转发
- 优势：过滤通信量、扩大物理范围、提高可靠性、互连不同速率局域网
- 问题与解决：多交换机互联可能产生环路，通过生成树算法（STP）断开冗余链路

### 6. 虚拟局域网（VLAN）
- 核心定义：以软件方式划分逻辑工作组，不受物理位置限制
- 构建方式：基于交换机端口、基于MAC地址、基于IP地址
- 关键技术：
  - 干线端口（Trunk Port）：转发多VLAN帧，通过802.1Q协议添加VLAN ID字段
  - 流量隔离：同一VLAN内设备可通信，不同VLAN需通过路由器转发
- 优势：灵活划分工作组、隔离广播流量、提高网络安全性

## 四、Wi-Fi：802.11无线局域网
### 1. 无线网络核心元素
- 硬件组成：无线主机（笔记本、手机、IoT设备）、基站/AP（接入点）、无线链路
- 组网形态：
  - Ad hoc网络：无基站，节点间直接通信的临时网络
  - Infrastructure网络：基于AP的基础结构网络，包含BSS（基本服务集）、ESS（扩展服务集）
  - 蓝牙主从网络：一个主设备连接多个从设备组成Piconet（微微网），主设备控制同步与跳频

### 2. 无线链路特征
- 信号衰减：自由空间路径损失，频率越高、距离越远衰减越严重
- 多径传播：信号经反射后不同步到达接收端，影响接收
- 干扰：2.4GHz等开放频段易受其他设备干扰
- 比特差错率（BER）：高于有线链路，SNR（信噪比）越高，BER越低

### 3. 关键问题：隐藏终端
- 定义：两个设备因障碍物或信号衰减无法互相感知，但均能与同一AP通信，同时发送会导致碰撞
- 解决：CSMA/CA协议中的RTS/CTS预约机制

### 4. 802.11协议簇演进
| 标准 | 发布年份 | 最大速率 | 工作频段 | 核心技术 |
|------|----------|----------|----------|----------|
| 802.11b | 1999 | 11Mbps | 2.4GHz | DSSS调制 |
| 802.11a | 1999 | 54Mbps | 5GHz | OFDM调制 |
| 802.11g | 2003 | 54Mbps | 2.4GHz | ERP-OFDM调制 |
| 802.11n（Wi-Fi 4） | 2009 | 600Mbps | 2.4/5GHz | 多天线、HT-OFDM |
| 802.11ac（Wi-Fi 5） | 2013 | 3.47Gbps | 5GHz | 多天线、VHT-OFDM |
| 802.11ax（Wi-Fi 6） | 2020 | 9.6Gbps | 2.4/5GHz | OFDMA、长符号持续时间 |

### 5. 802.11 MAC协议（CSMA/CA）
#### （1）发送方流程
1. 监听信道空闲DIFS秒后传输帧
2. 信道忙则选择随机退避值，信道空闲时递减
3. 退避值为0且信道空闲则发送数据
4. 收到ACK则继续发送下一包，未收到则扩大退避范围重传

#### （2）接收方流程
- 正确收到帧后，等待SIFS秒返回ACK（必须确认，解决隐藏终端问题）

#### （3）冲突避免机制（RTS/CTS）
1. 发送方发送短RTS帧预约信道
2. AP广播CTS帧响应，告知周边节点延迟发送
3. 发送方发送数据帧，接收方返回ACK
4. 优势：避免长帧碰撞，RTS/CTS碰撞代价低

### 6. 蓝牙技术补充
- 工作频段：2.4GHz ISM频段
- 核心特征：跳频扩频（FHSS）、主从结构（1主7从活跃连接）、支持点对点/点对多点
- 协议栈：无线电层、基带层、LMP、HCI、L2CAP、RFCOMM、SDP、应用层
- 安全机制：配对加密、身份认证、跳频技术、设备黑白名单

